<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: uploadUS.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: uploadUS.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable */
import React, { Component, useCallback } from "react";
import { useHistory } from 'react-router-dom';
import { withRouter } from 'react-router-dom'; 
import NavigationBar from "./components/NavigationBar";
import { Row, Col, Container, Button, Modal, Form } from "react-bootstrap";
import axios, { post } from "axios";

/**
 * User story upload page
 */
class ReactUSUpload extends React.Component {
  constructor(props) {
    super(props);
    /**
     * @property {file} file file uploaded by the user
     * @property {string} fileInputLabel placeholder string for the file upload button
     * @property {string} value heuristic value ('h1', 'h2'...)
     * @property {*} uploadedObject data representing the model to be drawn
     * @property {boolean} showWarning whether the warning modal is shown
     * @property {string} warningText text shown when the warning modal is visible 
     */
    this.state = {
      file: null,
      fileInputLabel: 'Select Your Goal Model Data',
      value: "",
      uploadedObject: {},
      showWarning: false,
      warningText: "Placeholder Text",
      banner1Css: { color: "#FFF", backgroundColor: "green" },
    };
    this.attemptFormSubmit = this.attemptFormSubmit.bind(this);
    this.onChange = this.onChange.bind(this);
    this.fileUpload = this.fileUpload.bind(this);
    this.setValue = this.setValue.bind(this)
    this.getHeuristicChoiceElement = this.getHeuristicChoiceElement.bind(this)
  }

  /**
   * Call when the "Create Model" submit button is pressed.
   * Sends the uploaded file and the heuristic selection to the backend.
   * If a response is received, opens the /playground page with the model generated in the backend. 
   * Shows a warning if a heuristic is not selected or a file is not uploaded.
   * @param {Event} e 
   * @returns True if the backend sends a response back
   */
  attemptFormSubmit(e) {
    if (this.state.value=="") {
      this.setState({showWarning: true, warningText:"You must select a heuristic to proceed"})
      return false
    } else if (this.state.file==null) {
      this.setState({showWarning: true, warningText:"You must choose a file to proceed"})
      return false
    }

    this.fileUpload(this.state.file).then((response) => {
        if (response) {
          this.props.history.push({pathname: "/playground", goalModel: response.data, selectedHeuristic: this.state.value, file: this.state.file})
          return true
        }
    });
    
    //this.setState({showWarning: true, warningText:"Model creation failed."})
    //return false
  }

  /**
   * Call when a new file is selected with the file selection form.
   * Sets the state to show the name of the selected file on the file selection form.
   * @param {Event} e File selection event 
   */
  onChange(e) {
    this.setState({
      file: e.target.files[0],
      fileInputLabel: e.target.files[0].name,
    });
  }

  /**
   * Call when a heuristic is selected
   * @param {string} newValue Heuristic value ('h1', 'h2'...)
   */
  setValue(newValue) {
    this.setState({value: newValue});    
  }

  /**
   * Call to send the file and the heuristic choice to the backend
   * @param {*} file 
   * @param {*} e 
   * @returns response from the backend which is a JSON string representing the elements to be drawn
   */
  fileUpload(file, e) {
    const url = "http://localhost:5000/upload";
    const formData = new FormData();
    formData.append("file", file);
    formData.append("value", this.state.value);
    const config = {
      headers: {
        "content-type": "application/json",
      },
    };
    return post(url, formData, config);
  }

  /**
   * Get the heuristic choice element.
   * @param {Object} itemData Heuristic choice data item 
   * @returns Heuristic choice element
   */
  getHeuristicChoiceElement(itemData) {
    return (&lt;div
      onClick = {() => this.setValue(itemData.value)}
      style   = {{cursor:'pointer'}}>
        &lt;img src={itemData.src} alt={itemData.alt} {...itemData.imageShape} />
        &lt;p>
          &lt;input
            type = 'radio'
            name = 'heu'
            value = {itemData.value}
            checked = {itemData.value === this.state.value}
            readOnly = {true}
            style = {{marginRight: "5px"}}
          />
          &lt;label
            className='label-style'
            style={{cursor: 'pointer'}}
          >
            {itemData.text}
          &lt;/label>
        &lt;/p>
    
    &lt;/div>) 
}
 
  render() {
    const HeuristicChoiceComponents = HeuristicChoiceData.map(item => this.getHeuristicChoiceElement(item))
    
    const { fileInputLabel } = this.state;
    return (
      &lt;div>
        &lt;NavigationBar page="home"/>
        &lt;form align="center">
        &lt;Container className="mt-5">
          &lt;Row>
            &lt;Col md="12">
                &lt;h2 className="text-center">Upload your user story set in .txt format&lt;/h2>
                &lt;hr/>
                &lt;p>There must be a single sentence in each line.&lt;/p>
                &lt;p>
                Expected sentence format:{" "}
                    &lt;q>
                        As a &lt;strong>role&lt;/strong>, I want &lt;strong>action&lt;/strong> so that{" "}
                        &lt;strong>benefit&lt;/strong>.
                    &lt;/q> 
                &lt;/p>
            &lt;/Col>
          &lt;/Row>
          &lt;p align="center">
          &lt;Form style={{width:"50%", margin:'auto'}}>
            &lt;Form.File id="formcheck-api-custom" custom>
              &lt;Form.File.Input accept=".txt" ref={this.fileInput} 
                  onChange={this.onChange} />
              &lt;Form.File.Label data-browse=". . .">
                { fileInputLabel } 
              &lt;/Form.File.Label>
              &lt;Form.Control.Feedback type="valid">If you submit it, your model will be updated!&lt;/Form.Control.Feedback>
              &lt;Form.Control.Feedback type="invalid"> {this.props.parseErrorMessage} &lt;/Form.Control.Feedback>
            &lt;/Form.File>
          &lt;/Form> 
          &lt;/p>
        &lt;/Container>

        &lt;p align="center">
          Select a model type to generate your customized goal model.
        &lt;/p>

        &lt;p align="center">Select a heuristic type.&lt;/p>
        &lt;Container className="mt-5">
          &lt;Row>
            &lt;Col md="6">
              {HeuristicChoiceComponents[0]}
            &lt;/Col>
            &lt;Col md="6">
              {HeuristicChoiceComponents[1]}
            &lt;/Col>
          &lt;/Row> 
          &lt;Row> 
            &lt;Col md="6">
              {HeuristicChoiceComponents[2]}
            &lt;/Col>
            &lt;Col md="6">
              {HeuristicChoiceComponents[3]}
            &lt;/Col>            
          &lt;/Row>
          &lt;Row>
            &lt;Col md="12">
              {HeuristicChoiceComponents[4]}
            &lt;/Col>
          &lt;/Row>
        &lt;/Container>
      &lt;/form>
      &lt;div align="center">
        &lt;CreateModelButton
          pathname="/playground"
          goalModel={this.state.uploadedObject}
          attemptFormSubmit={this.attemptFormSubmit}
        />{' '}
      &lt;/div>
      &lt;Modal
        show={this.state.showWarning}
        onHide={() => {this.setState({showWarning: false})}}
        size="md"
        aria-labelledby="contained-modal-title-vcenter"
        centered
      >
        &lt;Modal.Header closeButton>
          &lt;Modal.Title id="contained-modal-title-vcenter">
            Unable to Create Model
          &lt;/Modal.Title>
        &lt;/Modal.Header>
        &lt;Modal.Body>
          {this.state.warningText}
        &lt;/Modal.Body>
        &lt;Modal.Footer>
          &lt;Button variant="danger" onClick={() => {
            this.setState({showWarning: false})
          }}>Close&lt;/Button>
        &lt;/Modal.Footer>
      &lt;/Modal>
    &lt;/div>
  );
}
}

function CreateModelButton(props) {
  const handleClick = useCallback(() => 
    {
      props.attemptFormSubmit()
      
    }
  )

  return (
    &lt;Button as="input" type="submit" onClick={handleClick} value="Create Model" readOnly={true}/>
  )
}

import h1 from "./images/h1.PNG";
import h2 from "./images/h2.PNG";
import h3 from "./images/h3.PNG";
import h4 from "./images/h4.PNG";
import h5 from "./images/h5.PNG";

/**
 * Data of the heuristic choice elements
 * This data is used for creating heuristic choice elements in {@Link ReactUSUpload}
 */
const HeuristicChoiceData = [
  {
    alt: "Role-Action",
    value: "h1",
    text: "Grouped Action Verbs",
    src: h1,
    imageShape: {height:250}
  },
  {
    alt: "Role-Topic",
    value: "h2",
    text: "Grouped Action Object",
    src: h2,
    imageShape: {height:250}    
  },
  {
    alt: "Role",
    value:"h3",
    text: "Without Role Boundary",
    src: h3,
    imageShape: {height:250}
  },
  {
    alt: "Role-Benefit",
    value: "h4",
    text: "Grouped Benefit",
    src: h4,
    imageShape: {height:250}
  },
  {
    alt: "Benefit",
    value: "h5",
    text: "Benefit Without Role Boundary",
    src: h5,
    imageShape: {height:250}
  }
]

export default withRouter(ReactUSUpload);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Home.html">Home</a></li><li><a href="ImportDataModal.html">ImportDataModal</a></li><li><a href="MainPage.html">MainPage</a></li><li><a href="NavigationBar.html">NavigationBar</a></li><li><a href="Playground.html">Playground</a></li><li><a href="ReactUSUpload.html">ReactUSUpload</a></li><li><a href="SideBar.html">SideBar</a></li><li><a href="SwitchHeuristicButton.html">SwitchHeuristicButton</a></li></ul><h3>Global</h3><ul><li><a href="global.html#HeuristicChoiceData">HeuristicChoiceData</a></li><li><a href="global.html#PAPER_HEIGHT">PAPER_HEIGHT</a></li><li><a href="global.html#PAPER_WIDTH">PAPER_WIDTH</a></li><li><a href="global.html#SideBarItemData">SideBarItemData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Jul 17 2021 16:42:22 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
